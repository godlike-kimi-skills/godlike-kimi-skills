# 自动更新统计信息 / Auto Update Statistics
# 定期更新README中的统计数据

name: Update Stats / 更新统计

on:
  schedule:
    # 每天更新一次
    - cron: '0 2 * * *'
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - 'skills/**'

jobs:
  update-stats:
    name: Update README Stats / 更新README统计
    runs-on: ubuntu-latest
    steps:
      - name: Checkout / 检出代码
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Count skills / 统计skills数量
        id: count
        run: |
          # 统计skills数量
          SKILL_COUNT=$(find skills -maxdepth 1 -type d | wc -l)
          SKILL_COUNT=$((SKILL_COUNT - 1))  # 减去skills目录本身
          echo "skill_count=$SKILL_COUNT" >> $GITHUB_OUTPUT
          echo "Skills count: $SKILL_COUNT"
          
          # 统计分类数量
          # 这里简化处理，实际应该从README或其他配置读取
          CATEGORY_COUNT=7
          echo "category_count=$CATEGORY_COUNT" >> $GITHUB_OUTPUT

      - name: Update README badges / 更新README徽章
        run: |
          SKILL_COUNT=${{ steps.count.outputs.skill_count }}
          
          # 更新README中的skills数量徽章
          sed -i "s/Skills-[0-9]*/Skills-${SKILL_COUNT}/g" README.md
          sed -i "s/Skills-[0-9]*/Skills-${SKILL_COUNT}/g" README.md
          
          echo "Updated README with skill count: $SKILL_COUNT"

      - name: Commit changes / 提交更改
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          if git diff --quiet README.md; then
            echo "No changes to commit"
          else
            git add README.md
            git commit -m "chore: 更新统计数据 / Update stats

自动更新skills数量
Skills: ${{ steps.count.outputs.skill_count }}

静默期 / Stealth: Week 1"
            git push
          fi
